/*!
 * LocalModel
 * Developer: Rick Craig
 * https://github.com/RickCraig/localmodel
 */
"use strict";var isEmpty=function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},containsFalse=function(e){for(var t=0;t<e.length;t++)if(!e[t])return!0;return!1},generateUUID=function(){var e=Date.now(),t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)});return t},getKey=function(e,t){return e+"::"+t},addIndex=function(e,t){var n=e+"-index",i=localStorage.getItem(n),a=i?JSON.parse(i):[];a.push(t),localStorage.setItem(n,JSON.stringify(a))},getIndices=function(e){var t=localStorage.getItem(e+"-index");return JSON.parse(t)},getIndex=function(e,t){for(var n=new RegExp("::"+t,"g"),i=0;i<e.length;i++){var a=e[i];if(n.test(a))return a}},LocalDocument=function(e,t){this.schema=t,this.data={},this.indexKey=getKey(t.name,e._id);for(var n in e){var i=t.schema[n],a=e[n];i===LocalSchema.SchemaTypes.Date&&(a=new Date(a)),this.data[n]=a}};LocalDocument.prototype.save=function(){var e={};for(var t in this.schema.schema)e[t]=this.data[t];var n=getKey(this.schema.name,this.data._id);localStorage.setItem(n,JSON.stringify(e))};var LocalModel=function(e){this.options=e||{},this.models={}};LocalModel.prototype.addModel=function(e,t){var n=new LocalSchema(e,t);return this.models[e]=n,n},LocalModel.prototype.model=function(e){return this.models[e]?this.models[e]:(console.error('The model with name "'+e+'" does not exist.'),null)};var LocalSchema=function(e,t){this.schema=t,this.name=e};LocalSchema.prototype.create=function(e){var t={};t._id=generateUUID();for(var n in this.schema)t[n]=e[n];var i=getKey(this.name,t._id);return localStorage.setItem(i,JSON.stringify(t)),addIndex(this.name,i),this.indices=null,new LocalDocument(t,this)},LocalSchema.prototype.all=function(){this.indices=this.indices||getIndices(this.name);var e=[];if(!this.indices)return e;for(var t=0;t<this.indices.length;t++){var n=this.indices[t],i=JSON.parse(localStorage.getItem(n));e.push(new LocalDocument(i,this))}return e},LocalSchema.prototype.findById=function(e){this.indices=this.indices||getIndices(this.name);var t=getIndex(this.indices,e);return t?new LocalDocument(JSON.parse(localStorage.getItem(t)),this):null},LocalSchema.prototype.find=function(e){if(!e||isEmpty(e))return this.all();this.indices=this.indices||getIndices(this.name);var t=[];if(!this.indices)return t;for(var n=0;n<this.indices.length;n++){var i=localStorage.getItem(this.indices[n]),a=JSON.parse(i),r=[];for(var o in e){var s=e[o],c=s instanceof RegExp;(c||""!==s&&!isEmpty(s))&&a[o]&&r.push(matchQuery(a[o],s))}containsFalse(r)||t.push(new LocalDocument(a,this))}return t},LocalSchema.SchemaTypes={String:"string",Number:"number",Boolean:"boolean",Mixed:"mixed",Date:"date"};var matchQuery=function(e,t){if(t instanceof RegExp)return t.test(e);if("string"==typeof t||"number"==typeof t)return e===t;if("object"==typeof t&&"number"==typeof e){var n=[];return t.$gte&&n.push(t.$gte<=e),t.$gt&&n.push(t.$gt<e),t.$lte&&n.push(t.$lte>=e),t.$lt&&n.push(t.$lt>e),!containsFalse(n)}};